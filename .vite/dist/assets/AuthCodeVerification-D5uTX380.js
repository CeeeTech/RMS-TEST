import{r as X,ai as De,M as xe,T as Ne,aC as Ae,l as w,G as M,F as je,S as Ee,D as se,a4 as ue}from"./index-DRAxbQhQ.js";import{S as ce}from"./swal-D3ymrZ7_.js";import{C as Re}from"./CircularProgress-BO7Tj77P.js";var le={};(function(I){Object.defineProperty(I,"__esModule",{value:!0}),I.default=void 0;var h=j(X),A=["placeholder","separator","isLastChild","ariaLabelOverride","shouldRender","inputStyle","focus","isDisabled","hasErrored","errorStyle","isSuccessed","successStyle","focusStyle","disabledStyle","shouldAutoFocus","isInputNum","index","value","className","isInputSecure","onSubmit"];function k(t){if(typeof WeakMap!="function")return null;var a=new WeakMap,i=new WeakMap;return(k=function(n){return n?i:a})(t)}function j(t,a){if(!a&&t&&t.__esModule)return t;if(t===null||V(t)!=="object"&&typeof t!="function")return{default:t};var i=k(a);if(i&&i.has(t))return i.get(t);var e={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var c=n?Object.getOwnPropertyDescriptor(t,s):null;c&&(c.get||c.set)?Object.defineProperty(e,s,c):e[s]=t[s]}return e.default=t,i&&i.set(t,e),e}function v(){return v=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])}return t},v.apply(this,arguments)}function $(t,a){if(t==null)return{};var i=E(t,a),e,n;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(n=0;n<s.length;n++)e=s[n],!(a.indexOf(e)>=0)&&Object.prototype.propertyIsEnumerable.call(t,e)&&(i[e]=t[e])}return i}function E(t,a){if(t==null)return{};var i={},e=Object.keys(t),n,s;for(s=0;s<e.length;s++)n=e[s],!(a.indexOf(n)>=0)&&(i[n]=t[n]);return i}function F(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function L(t,a){for(var i=0;i<a.length;i++){var e=a[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function U(t,a,i){return a&&L(t.prototype,a),i&&L(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function y(t,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),a&&m(t,a)}function m(t,a){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,n){return e.__proto__=n,e},m(t,a)}function x(t){var a=R();return function(){var e=B(t),n;if(a){var s=B(this).constructor;n=Reflect.construct(e,arguments,s)}else n=e.apply(this,arguments);return N(this,n)}}function N(t,a){if(a&&(V(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return u(t)}function u(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function R(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function B(t){return B=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},B(t)}function p(t,a,i){return a in t?Object.defineProperty(t,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[a]=i,t}function V(t){"@babel/helpers - typeof";return V=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},V(t)}var pe=8,fe=37,de=39,he=46,ve=32,ye=13,_=function(a){return V(a)==="object"},me=function(t){y(i,t);var a=x(i);function i(e){var n;return F(this,i),n=a.call(this,e),p(u(n),"getClasses",function(){for(var s=arguments.length,c=new Array(s),r=0;r<s;r++)c[r]=arguments[r];return c.filter(function(o){return!_(o)&&o!==!1}).join(" ")}),p(u(n),"getType",function(){var s=n.props,c=s.isInputSecure,r=s.isInputNum;return c?"password":r?"tel":"text"}),p(u(n),"getAriaLabel",function(s,c){var r=n.props.ariaLabelOverride;return r||"".concat(s===0?"Please enter verification code. ":"").concat(c?"Digit":"Character"," ").concat(s+1)}),n.input=h.default.createRef(),n}return U(i,[{key:"componentDidMount",value:function(){var n=this.props,s=n.focus,c=n.shouldAutoFocus,r=this.input.current;r&&s&&c&&r.focus()}},{key:"componentDidUpdate",value:function(n){var s=this.props.focus,c=this.input.current;n.focus!==s&&c&&s&&(c.focus(),c.select())}},{key:"render",value:function(){var n=this.props,s=n.placeholder,c=n.separator,r=n.isLastChild;n.ariaLabelOverride;var o=n.shouldRender,l=n.inputStyle,g=n.focus,O=n.isDisabled,b=n.hasErrored,f=n.errorStyle,S=n.isSuccessed,P=n.successStyle,D=n.focusStyle,C=n.disabledStyle;n.shouldAutoFocus;var K=n.isInputNum,q=n.index,W=n.value,J=n.className;n.isInputSecure,n.onSubmit;var G=$(n,A);return h.default.createElement("div",{className:J,style:{display:"flex",alignItems:"center"}},h.default.createElement("input",v({"aria-label":this.getAriaLabel(q,K),style:Object.assign({width:"1em",textAlign:"center",padding:0},_(l)&&l,g&&_(D)&&D,O&&_(C)&&C,b&&!S&&_(f)&&f,S&&!b&&_(P)&&P),placeholder:s,className:this.getClasses(l,g&&D,O&&C,b&&!S&&f,S&&!b&&P),type:this.getType(),ref:this.input,disabled:O,value:W||""},G)),!r&&o&&c)}}]),i}(h.PureComponent),Y=function(t){y(i,t);var a=x(i);function i(){var e;F(this,i);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return e=a.call.apply(a,[this].concat(s)),p(u(e),"state",{activeInput:0}),p(u(e),"getOtpValue",function(){return e.props.value?e.props.value.toString().split(""):[]}),p(u(e),"getPlaceholderValue",function(){var r=e.props,o=r.placeholder,l=r.numInputs;if(typeof o=="string"){if(o.length===l)return o;o.length>0&&console.error("Length of the placeholder should be equal to the number of inputs.")}}),p(u(e),"handleOtpChange",function(r){var o=e.props.onChange,l=r.join("");o(l)}),p(u(e),"isInputValueValid",function(r){var o=e.props.isInputNum?!isNaN(parseInt(r,10)):typeof r=="string";return o&&r.trim().length===1}),p(u(e),"focusInput",function(r){var o=e.props.numInputs,l=Math.max(Math.min(o-1,r),0);e.setState({activeInput:l})}),p(u(e),"focusNextInput",function(){var r=e.state.activeInput;e.focusInput(r+1)}),p(u(e),"focusPrevInput",function(){var r=e.state.activeInput;e.focusInput(r-1)}),p(u(e),"changeCodeAtFocus",function(r){var o=e.state.activeInput,l=e.getOtpValue();l[o]=r[0],e.handleOtpChange(l)}),p(u(e),"handleOnPaste",function(r){r.preventDefault();var o=e.state.activeInput,l=e.props,g=l.numInputs,O=l.isDisabled;if(!O){for(var b=e.getOtpValue(),f=o,S=r.clipboardData.getData("text/plain"),P=e.props.isInputNum?S.replace(/\D/g,""):S,D=P.slice(0,g-o).split(""),C=0;C<g;++C)C>=o&&D.length>0&&(b[C]=D.shift(),f++);e.setState({activeInput:f},function(){e.focusInput(f),e.handleOtpChange(b)})}}),p(u(e),"handleOnChange",function(r){var o=r.target.value;e.isInputValueValid(o)&&e.changeCodeAtFocus(o)}),p(u(e),"handleOnKeyDown",function(r){r.keyCode===pe||r.key==="Backspace"?(r.preventDefault(),e.changeCodeAtFocus(""),e.focusInput(e.state.activeInput-1)):r.keyCode===he||r.key==="Delete"?(r.preventDefault(),e.changeCodeAtFocus("")):r.keyCode===fe||r.key==="ArrowLeft"?(r.preventDefault(),e.focusPrevInput()):r.keyCode===de||r.key==="ArrowRight"?(r.preventDefault(),e.focusNextInput()):r.keyCode===ve||r.key===" "||r.key==="Spacebar"||r.key==="Space"?r.preventDefault():(r.keyCode===ye||r.key==="Enter")&&e.props.onSubmit()}),p(u(e),"handleOnInput",function(r){var o=r.target.value;if(r.target.value){if(r.target.value&&r.target.value.length>1){r.preventDefault();for(var l=e.props.numInputs,g=e.state.activeInput,O=e.getOtpValue(),b=r.target.value.slice(0,l-g).split(""),f=0;f<l;++f)f>=g&&b.length>0&&(O[f]=b.shift());e.handleOtpChange(O),e.focusInput(e.props.numInputs)}else if(o&&o.trim().length>1)r.clipboardData={getData:function(){return o.trim()}},e.handleOnPaste(r);else if(e.isInputValueValid(r.target.value))e.focusNextInput();else if(!e.props.isInputNum){var S=r.nativeEvent;S.data===null&&S.inputType==="deleteContentBackward"&&(r.preventDefault(),e.changeCodeAtFocus(""),e.focusPrevInput())}}}),p(u(e),"renderInputs",function(){for(var r=e.state.activeInput,o=e.props,l=o.id,g=o.autoComplete,O=o.numInputs,b=o.inputStyle,f=o.focusStyle,S=o.separator,P=o.separateAfter,D=P===void 0?1:P,C=o.isDisabled,K=o.disabledStyle,q=o.hasErrored,W=o.errorStyle,J=o.isSuccessed,G=o.successStyle,be=o.shouldAutoFocus,Se=o.isInputNum,Ie=o.isInputSecure,Oe=o.className,T=o.inputProps,Ce=o.onSubmit,Z=[],ee=e.getOtpValue(),te=e.getPlaceholderValue(),re=e.props["data-cy"],ne=e.props["data-testid"],ae=e.props["custom-test-attr"],oe=e.props["custom-test-id"],we=function(d){var H=void 0;(d+1)%parseInt(D)===0?H=!0:H=!1;var ie={};ae&&(ie[ae]=oe&&"".concat(oe,"-").concat(d));var Q={};T&&(Array.isArray(T)?T[d]&&(Q=T[d]):Q=T),Z.push(h.default.createElement(me,v({id:l&&"".concat(l,"-").concat(d),autoComplete:g??"off",placeholder:te&&te[d],key:d,index:d,focus:r===d,value:ee&&ee[d],onChange:e.handleOnChange,onKeyDown:e.handleOnKeyDown,onInput:e.handleOnInput,onPaste:e.handleOnPaste,onFocus:function(_e){e.setState({activeInput:d}),_e.target.select()},onBlur:function(){return e.setState({activeInput:-1})},separator:S,inputStyle:b,focusStyle:f,isLastChild:d===O-1,isDisabled:C,disabledStyle:K,hasErrored:q,errorStyle:W,isSuccessed:J,successStyle:G,shouldAutoFocus:be,isInputNum:Se,isInputSecure:Ie,className:Oe,"data-cy":re&&"".concat(re,"-").concat(d),"data-testid":ne&&"".concat(ne,"-").concat(d),shouldRender:H,onSubmit:Ce},Q,ie)))},z=0;z<O;z++)we(z);return Z}),e}return U(i,[{key:"componentDidUpdate",value:function(){var n=this.props.value,s=this.state.activeInput;n==""&&s>0&&this.setState({activeInput:0})}},{key:"render",value:function(){var n=this.props.containerStyle;return h.default.createElement("div",{style:Object.assign({display:"flex"},_(n)&&n),className:_(n)?"":n},this.renderInputs())}}]),i}(h.Component);p(Y,"defaultProps",{numInputs:4,onChange:function(a){return console.log(a)},isDisabled:!1,shouldAutoFocus:!1,value:"",isInputSecure:!1,onSubmit:function(a){return console.log(a)}});var ge=Y;I.default=ge})(le);const Ve=De(le);ce.mixin({toast:!0,position:"top-start",iconColor:"white",customClass:{popup:"colored-toast"},showConfirmButton:!1,timer:3500,timerProgressBar:!0});const Ue=()=>{const I=ce.mixin({toast:!0,position:"top-start",iconColor:"white",customClass:{popup:"colored-toast"},showConfirmButton:!1,timer:3500,timerProgressBar:!0}),h=xe(),[A,k]=X.useState(""),[j,v]=X.useState(!1),$=h.palette.mode===Ne.DARK?h.palette.grey[200]:h.palette.grey[300],E=Ae();async function F(y){try{const m=JSON.parse(localStorage.getItem("tempUser")),x=m.contact_number,N=m._id;if(!x){I.fire({icon:"error",title:"No Phone Number Found"}),console.error("No phone number found");return}const u=await fetch(ue.apiUrl+"api/referral/verifyCode",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:x,verificationCode:y,id:N})});if(u.ok){const R=await u.json();console.log(R),I.fire({icon:"success",title:"Verified Successfully!"}),E("/login"),localStorage.removeItem("tempUser")}else{const R=await u.json();throw new Error(R.error)}console.log("Verified")}catch(m){console.error("Error sending verification code:",m.message),I.fire({icon:"error",title:m.message}),m.message=="User Already been Verified"&&(E("/login"),localStorage.removeItem("tempUser"))}}const L=async()=>{if(v(!0),A.trim()===""){I.fire({icon:"error",title:"Verification Code is Empty"}),console.error("Verification code is empty"),v(!1);return}await F(A),v(!1)},U=async()=>{v(!0);try{const y=JSON.parse(localStorage.getItem("tempUser")),m=y.contact_number,x=y._id;if(!m){I.fire({icon:"error",title:"No Phone Number Found"}),console.error("No phone number found"),v(!1);return}const N=await fetch(ue.apiUrl+"api/referral/resend-verification-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:m,id:x})});if(N.ok){I.fire({icon:"success",title:"Verification Code Resent Successfully"}),v(!1);const u=await N.json();console.log(u)}else{v(!1);const u=await N.json();throw new Error(u.error)}console.log("Verified")}catch(y){console.error("Error sending verification code:",y.message),I.fire({icon:"error",title:y.message}),v(!1),y.message=="User Already been Verified"&&(E("/login"),localStorage.removeItem("tempUser"))}};return w.jsxs(M,{container:!0,spacing:3,children:[w.jsx(M,{item:!0,xs:12,children:w.jsx(Ve,{value:A,onChange:y=>k(y),numInputs:4,containerStyle:{justifyContent:"space-between"},inputStyle:{width:"100%",margin:"8px",padding:"10px",border:`1px solid ${$}`,borderRadius:4,":hover":{borderColor:h.palette.primary.main}},focusStyle:{outline:"none",border:`2px solid ${h.palette.primary.main}`}})}),w.jsx(M,{item:!0,xs:12,children:w.jsx(je,{disableElevation:!0,fullWidth:!0,size:"large",type:"submit",variant:"contained",disabled:j,onClick:L,children:j?w.jsx(Re,{color:"inherit"}):"Continue"})}),w.jsx(M,{item:!0,xs:12,children:w.jsxs(Ee,{direction:"row",justifyContent:"space-between",alignItems:"baseline",children:[w.jsx(se,{children:"Did not receive the message?"}),!j&&w.jsx(se,{variant:"body1",sx:{minWidth:85,ml:2,textDecoration:"none",cursor:"pointer"},onClick:U,color:"primary",children:"Resend code"})]})})]})};export{Ue as A};
