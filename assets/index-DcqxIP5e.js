import{x as f,y as g,l as e,e as l,Y as p,Z as h,F as _,r as s,$ as W,L as T,a0 as Y,C as K,G as o,a1 as Q,D as Z,a2 as X,a3 as ee,a4 as y}from"./index-D1jq9kJH.js";import{d as re}from"./Search-C3dx88yC.js";import{R as u}from"./RevenueCard-Bw_vS4vI.js";import{d as te}from"./BlockTwoTone-sjFfNGVG.js";import{u as ae,a as oe}from"./useLogout-BJ8gzmSp.js";import{d as ie}from"./Add-CIGxFMI0.js";import{d as ne}from"./FormatListBulleted-Cd-3t-yE.js";import{D as $}from"./DataGrid-DYKy88ZK.js";import{T as se}from"./TextField-CZtuqMzg.js";import{I as de}from"./InputAdornment-DJGYiVlo.js";import"./CircularProgress-BfwiGi9n.js";import"./toPropertyKey-H7AvS4qg.js";import"./typeof-QjJsDpFa.js";import"./InputBase-CmWFd4JY.js";import"./utils-DoM3o7-Q.js";import"./Autocomplete-BxsNeNHF.js";import"./Select-ZcV0niJu.js";import"./Menu-SXZ0ZIrG.js";import"./OutlinedInput-DN1we0wm.js";import"./ListSubheader-Bx3um0z-.js";import"./usePreviousProps-DtuR8-wm.js";import"./MenuItem-CEXjQcJ-.js";import"./Badge-ld2FrWRe.js";import"./Checkbox-DY75TCaV.js";import"./FormControl-BhfPE8_O.js";import"./Switch-DNTTpQBE.js";import"./Tooltip-BnzKm6rU.js";import"./InputLabel-B26CM0Hw.js";import"./FormLabel-Dsek0Nea.js";import"./Skeleton-D0CkMoTC.js";import"./TablePagination-gjp86BJc.js";import"./LastPage-Bu0cjKB7.js";import"./TableCell-Bay4XfoM.js";import"./FormHelperText-Cniy_4F_.js";var R={},ce=g;Object.defineProperty(R,"__esModule",{value:!0});var L=R.default=void 0,le=ce(f()),ue=e;L=R.default=(0,le.default)((0,ue.jsx)("path",{d:"m19 8-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4z"}),"CachedTwoTone");var C={},pe=g;Object.defineProperty(C,"__esModule",{value:!0});var P=C.default=void 0,me=pe(f()),v=e;P=C.default=(0,me.default)([(0,v.jsx)("circle",{cx:"11",cy:"8",r:"2",opacity:".3"},"0"),(0,v.jsx)("path",{d:"M5 18h4.99L9 17l.93-.94C7.55 16.33 5.2 17.37 5 18",opacity:".3"},"1"),(0,v.jsx)("path",{d:"M11 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0-6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m-1 12H5c.2-.63 2.55-1.67 4.93-1.94h.03l.46-.45L12 14.06c-.39-.04-.68-.06-1-.06-2.67 0-8 1.34-8 4v2h9zm10.6-5.5-5.13 5.17-2.07-2.08L12 17l3.47 3.5L22 13.91z"},"2")],"HowToRegTwoTone");var b={},fe=g;Object.defineProperty(b,"__esModule",{value:!0});var F=b.default=void 0,ge=fe(f()),j=e;F=b.default=(0,ge.default)([(0,j.jsx)("path",{d:"M12 4c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8m.88 13.76V19h-1.75v-1.29c-.74-.18-2.39-.77-3.02-2.96l1.65-.67c.06.22.58 2.09 2.4 2.09.93 0 1.98-.48 1.98-1.61 0-.96-.7-1.46-2.28-2.03-1.1-.39-3.35-1.03-3.35-3.31 0-.1.01-2.4 2.62-2.96V5h1.75v1.24c1.84.32 2.51 1.79 2.66 2.23l-1.58.67c-.11-.35-.59-1.34-1.9-1.34-.7 0-1.81.37-1.81 1.39 0 .95.86 1.31 2.64 1.9 2.4.83 3.01 2.05 3.01 3.45 0 2.63-2.5 3.13-3.02 3.22",opacity:".3"},"0"),(0,j.jsx)("path",{d:"M12.89 11.1c-1.78-.59-2.64-.96-2.64-1.9 0-1.02 1.11-1.39 1.81-1.39 1.31 0 1.79.99 1.9 1.34l1.58-.67c-.15-.44-.82-1.91-2.66-2.23V5h-1.75v1.26c-2.6.56-2.62 2.85-2.62 2.96 0 2.27 2.25 2.91 3.35 3.31 1.58.56 2.28 1.07 2.28 2.03 0 1.13-1.05 1.61-1.98 1.61-1.82 0-2.34-1.87-2.4-2.09l-1.66.67c.63 2.19 2.28 2.78 3.02 2.96V19h1.75v-1.24c.52-.09 3.02-.59 3.02-3.22.01-1.39-.6-2.61-3-3.44"},"1"),(0,j.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"},"2")],"PaidTwoTone");var w={},he=g;Object.defineProperty(w,"__esModule",{value:!0});var k=w.default=void 0,xe=he(f()),D=e;k=w.default=(0,xe.default)([(0,D.jsx)("path",{d:"M13 4H6v16h12V9h-5z",opacity:".3"},"0"),(0,D.jsx)("path",{d:"m20 8-6-6H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2zm-2 12H6V4h7v5h5z"},"1")],"InsertDriveFileTwoTone");const m=.1;l($)(({theme:t})=>({"& .${gridClasses.row}.even":{backgroundColor:t.palette.grey[200],"&:hover, &.Mui-hovered":{backgroundColor:p(t.palette.primary.main,m),"@media (hover: none)":{backgroundColor:"transparent"}},"&.Mui-selected":{backgroundColor:p(t.palette.primary.main,m+t.palette.action.selectedOpacity),"&:hover, &.Mui-hovered":{backgroundColor:p(t.palette.primary.main,m+t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:p(t.palette.primary.main,m+t.palette.action.selectedOpacity)}}}}}));l(h)(({theme:t})=>({backgroundColor:t.palette.primary[800],color:t.palette.primary.contrastText,padding:t.spacing(3),borderRadius:t.shape.borderRadius,marginBottom:t.spacing(3)}));l(h)(({theme:t})=>({borderRadius:t.shape.borderRadius,padding:t.spacing(2),background:"#fff",marginBottom:t.spacing(2)}));l(h)(({theme:t})=>({borderRadius:t.shape.borderRadius,padding:t.spacing(2),backgroundColor:"#0444B0",color:"#FFFFFF",height:"100px",marginBottom:t.spacing(2)}));l(_)(({theme:t})=>({textTransform:"none",borderRadius:t.shape.borderRadius,backgroundColor:"#1976d2",color:"#FFFFFF","&:hover":{backgroundColor:"#1976d2"}}));l(h)(({theme:t})=>({padding:t.spacing(2),borderRadius:t.shape.borderRadius}));function rr(){const t={registered:"primary",dropped:"error",processing:"warning",paid:"success"},{user:n}=ae(),{logout:d}=oe(),[S,M]=s.useState([]),[c,z]=s.useState(!0),[ye,E]=s.useState(""),[I,O]=s.useState(0),[N,A]=s.useState(0);async function B(){try{const r=await fetch(y.apiUrl+"api/referral/getReferralByReferee",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.token}`},body:JSON.stringify({referee_id:n._id})});if(!r.ok){if(r.status===401&&(console.error("Unauthorized access. Logging out."),d()),r.status===500){console.error("Internal Server Error."),d();return}return}const a=await r.json();if(console.log("Referrals:",a),!Array.isArray(a.referrals))throw new Error("Data received from server does not contain a valid referrals array");const x=a.referrals.map(i=>({id:i._id,date:V(i.date),reference_number:i.reference_number,student_name:i.student_id?i.student_id.name:"",course_name:i.course_id?i.course_id.name:"",mobile_number:i.student_id?i.student_id.contact_no:"",potential_earning:i.potential_earning?i.potential_earning:0,status:i.ref_status_id?i.ref_status_id.name:""}));return M(x),!0}catch(r){return console.error("Error fetching referrals:",r),!1}}async function H(){try{const r=await fetch(y.apiUrl+"api/referral/getReferralCountByReferee",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.token}`},body:JSON.stringify({referee_id:n._id})});if(!r.ok)return r.status===401?(console.error("Unauthorized access. Logging out."),d(),!1):(r.status===500&&(console.error("Internal Server Error."),d()),!1);const a=await r.json();return O(a),console.log("Referral count:",a),!0}catch(r){return console.error("Error getting referral count:",r),!1}}async function U(){try{const r=await fetch(y.apiUrl+"api/referral/getRegisteredReferralCountByReferee",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.token}`},body:JSON.stringify({referee_id:n._id})});if(!r.ok)return r.status===401?(console.error("Unauthorized access. Logging out."),d(),!1):(r.status===500&&(console.error("Internal Server Error."),d()),!1);const a=await r.json();return A(a),console.log("Registered referral count:",a),!0}catch(r){return console.error("Error getting registered referral count:",r),!1}}function V(r){const a=new Date(r),x=String(a.getMonth()+1).padStart(2,"0"),i=String(a.getDate()).padStart(2,"0");return`${a.getFullYear()}-${x}-${i}`}const q=r=>{E(r.target.value)},G=async()=>{await B(),await H(),await U(),z(!1)};s.useEffect(()=>{G()},[]),s.useEffect(()=>{console.log("user:",n)},[S]);const J=[{field:"reference_number",headerName:"#",width:90},{field:"date",headerName:"Date",width:120},{field:"student_name",headerName:"Student Name",width:185},{field:"course_name",headerName:"Course Name",width:260},{field:"mobile_number",headerName:"Mobile Number",width:150},{field:"potential_earning",headerName:"Potential Earning(LKR)",flex:1,valueFormatter:r=>{const a=r.value;return a!=null?a.toFixed(2):"Not available"}},{field:"status",headerName:"Status",width:200,renderCell:r=>e.jsx(ee,{label:r.value.charAt(0).toUpperCase()+r.value.slice(1).toLowerCase(),color:t[r.value]||"default",style:{width:110}})}];return e.jsx(W,{title:"Dashboard",secondary:e.jsxs(e.Fragment,{children:[e.jsx(T,{to:"/createNewReferralForm",children:e.jsx(_,{variant:"contained",endIcon:e.jsx(ie,{style:{fontSize:"23px"}}),children:"Add New Refferal"})}),e.jsxs(Y,{mdUp:!0,children:[e.jsx("br",{}),e.jsx(T,{to:"/courseDetails",children:e.jsxs(_,{color:"success",variant:"contained",style:{marginTop:10,color:"white",backgroundColor:"#00954d"},endIcon:e.jsx(ne,{style:{fontSize:"23px"}}),children:["View Courses"," "]})})]})]}),children:e.jsx(K,{maxWidth:"lg",children:e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xs:12,children:e.jsxs(o,{container:!0,spacing:Q,children:[e.jsx(o,{item:!0,sm:6,md:4}),e.jsx(o,{item:!0,xs:12}),e.jsx(o,{item:!0,lg:4,md:4,sm:6,xs:12,sx:{marginTop:r=>({xs:"-45px",sm:"0px"})},children:e.jsx(u,{isLoading:c,primary:"Registration",secondary:N.registeredReferralCount,iconPrimary:P,color:"#04AA6D"})}),e.jsx(o,{item:!0,lg:4,md:4,sm:6,xs:12,children:e.jsx(u,{isLoading:c,primary:"Processing",secondary:"0",iconPrimary:L,color:"#3887BE"})}),e.jsx(o,{item:!0,lg:4,md:4,sm:6,xs:12,children:e.jsx(u,{isLoading:c,primary:"Paid (LKR)",secondary:"0",iconPrimary:F,color:"#E9B824"})}),e.jsx(o,{item:!0,lg:6,md:4,sm:6,xs:12,children:e.jsx(u,{isLoading:c,primary:"Dropped",secondary:"0",iconPrimary:te,color:"#EE9322"})}),e.jsx(o,{item:!0,lg:6,md:4,sm:6,xs:12,children:e.jsx(u,{primary:"Referrals",secondary:I.referralCount,iconPrimary:k,isLoading:c,color:"#211C6A"})})]})}),e.jsx(o,{item:!0,xs:12}),e.jsxs(o,{container:!0,alignItems:"center",justifyContent:"space-between",sx:{px:3,py:2},children:[e.jsx(o,{item:!0,children:e.jsx(Z,{variant:"h3",component:"h3",children:"Referral List"})}),e.jsx(o,{item:!0,xs:8,sm:4,children:e.jsx(se,{fullWidth:!0,margin:"normal",type:"text",onChange:q,InputProps:{startAdornment:e.jsx(de,{position:"start",children:e.jsx(re,{})})}})})]}),e.jsxs(o,{item:!0,xs:12,children:[c&&e.jsx(X,{}),e.jsx(o,{item:!0,xs:12,children:e.jsx("div",{style:{height:720,width:"100%"},children:e.jsx($,{rows:S,columns:J,rowHeight:40,initialState:{pagination:{paginationModel:{page:0,pageSize:14}}},pageSizeOptions:[10,14,100],getStatusWithColor:!0})})})]})]})})})}export{rr as default};
